---
import Layout from "@/layouts/Layout.astro";

interface MenuItem {
    title: string;
    price: number;
    description: string;
    image: string;
}

const SHEET_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vRhT-0PjkNDVvPhfPm-e5-DMafbWvyugaenGg34b27nCy3JvziaR-mNOzILGcasgPpw0vTvl1DNaes_/pub?output=csv";

async function fetchMenuItems() {
    const response = await fetch(SHEET_URL);
    const text = await response.text();

    return text
        .split("\n")
        .slice(1)
        .map((row) => {
            // Expresi√≥n regular para dividir respetando comillas
            const matches = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);

            if (!matches || matches.length < 4) return null; // Evitar errores

            const [title, price, description, image] = matches.map(
                (item) => item.replace(/^"|"$/g, "").replace(/""/g, '"').trim() // üîπ Corrige comillas dobles
            );

            return {
                title,
                price: parseFloat(price),
                description,
                image: image || "/placeholder.svg",
            };
        })
        .filter(Boolean);
}

const menuItems: MenuItem[] = (await fetchMenuItems()).filter(
    (item) => item !== null
) as MenuItem[];
---

<Layout title="Cartas">
    <section class="container mx-auto px-4 py-20">
        <h1 class="text-3xl font-bold text-center mb-8 text-white">
            Nuestro Men√∫
        </h1>
        <div class="grid gap-6 md:grid-cols-2">
            {
                menuItems.map((item, index) => (
                    <div class="bg-zinc-400/10 backdrop-blur-lg border-zinc-50/20 rounded-lg shadow-md overflow-hidden flex text-white">
                        <div class="w-1/3 relative">
                            <img
                                src={item.image || "/placeholder.svg"}
                                alt={item.title}
                                class="relative z-10 object-cover w-full h-full md:h-36"
                            />
                            <img
                                src={item.image || "/placeholder.svg"}
                                alt={item.title}
                                class="absolute blur-xl inset-0 z-0 object-cover w-full h-full md:h-36"
                            />
                        </div>
                        <div class="w-2/3 p-6">
                            <div class="flex justify-between items-center mb-2">
                                <h2 class="text-xl font-semibold">
                                    {item.title}
                                </h2>
                                <span class="text-lg font-bold text-primary">
                                    ${item.price.toFixed(2)}
                                </span>
                            </div>
                            <p class="text-zinc-400">{item.description}</p>
                        </div>
                    </div>
                ))
            }
        </div>
    </section>
</Layout>
